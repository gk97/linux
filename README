CMPE 283: Virtualization
Assignment 2: Instrumentation via hypercall
Assignment 3: Instrumentation via hypercall (cont’d)

Team Members: Guru Karthik (only one person)
Student ID: 015238509

CPU leaf nodes implemented in this assignment are :
	For CPUID leaf node %eax=0x4FFFFFFF:
		Return the total number of exits (all types) in %eax
	For CPUID leaf node %eax=0x4FFFFFFE:
		Return the high 32 bits of the total time spent processing all exits in %ebx
		Return the low 32 bits of the total time spent processing all exits in %ecx
		%ebx and %ecx return values are measured in processor cycles, across all VCPUs
	For CPUID leaf node %eax=0x4FFFFFFD:
		 Return the number of exits for the exit number provided (on input) in %ecx
		This value should be returned in %eax 
	For CPUID leaf node %eax=0x4FFFFFFC:
		Return the time spent processing the exit number provided (on input) in %ecx
		Return the high 32 bits of the total time spent for that exit in %ebx
		Return the low 32 bits of the total time spent for that exit in %ecx
		
Steps followed for the assignment

    Download and install VMWare WorkStation
	Download Ubuntu 20.04.3 iso
	Create Ubuntu VM in the VMWare using the iso
	Provide atleast 8GB of RAM, 200GB of Harddisk, 6 CPUs
	
The the Linux kernel source code is forked from git (https://github.com/torvalds/linux). Clone the forked repo from git.
Download the provided MakeFile

Run the following commands
	sudo apt-get install manpages-dev
    make oldconfig
    make clean
    make prepare
    make -j 8 modules
    sudo make INSTALL_MOD_STRIP=1 modules_install & make install
    lsmod | grep kvm
    rmmod kvm_intel
    rmmod kvm
    modprobe kvm
    modprobe kvm_intel


Modify cpuid.c file and vmx.c file to report back additional information when special CPUID leaf nodes are requested.
	2)
		Return the high 32 bits of the total time spent processing all exits in %ebx
		Return the low 32 bits of the total time spent processing all exits in %ecx
	3) 
		Return the number of exits for the exit number provided (on input) in %ecx
	4)
		Return the time spent processing the exit number provided (on input) in %ecx

Comment on the frequency of exits – does the number of exits increase at a stable rate? Or are there 
more exits performed during certain VM operations? Approximately how many exits does a full VM 
boot entail?

	Total number of exits were not stable. MSR access resulted in more exits. A full VM boot resulted in 1252565 exits.

Of the exit types defined in the SDM, which are the most frequent? Least?
	
	Most frequent exits were: Interrupt Window (exit number 7) and MSR_WRITE (exit number 32)
	Least frequent exits were: MOV DR (exit number 29)



